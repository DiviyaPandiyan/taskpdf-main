import React, { useRef, useState, useEffect } from "react";
import pdfMake from "pdfmake/build/pdfmake";
import htmlToPdfmake from "html-to-pdfmake";
import logo from "./assets/paperz.png";

const MyPage = () => {
  const pageRef = useRef();
  const [base64Image, setBase64Image] = useState("");

  // Convert the image file to base64 when the component mounts
  useEffect(() => {
    const convertImageFileToBase64 = (file) => {
      const reader = new FileReader();
      reader.onloadend = () => {
        setBase64Image(reader.result); // Convert image to base64
        console.log(reader.result);
      };
      reader.readAsDataURL(file);
    };

    // Fetch the image file (e.g., from URL or import)
    fetch(logo)
      .then((res) => res.blob())
      .then((blob) => convertImageFileToBase64(blob));
  }, []);

  // Handle PDF generation
  const handleGeneratePdf = () => {
    const htmlContent = pageRef.current.innerHTML;
    const pdfMakeContent = htmlToPdfmake(htmlContent);

    const documentDefinition = {
      content: pdfMakeContent
    };

    pdfMake.createPdf(documentDefinition).download("webpage-content.pdf");
  };

  return (
    <div style={{ textAlign: "center", marginTop: "20px" }}>
      <div ref={pageRef}>
        <h1 style={{ marginBottom: "20px", textAlign: "center" }}>Welcome</h1>
        {base64Image && (
          <img
            src={base64Image}
            alt="Logo"
            width={100}
            style={{ marginBottom: "20px", textAlign: "center" }}
          />
        )}
        <h2 style={{ textAlign: "center" }}>Styled Section</h2>
        <p style={{ textAlign: "center" }}>
          This section has custom styling applied.
        </p>
      </div>
      <button onClick={handleGeneratePdf}>Download Page as PDF</button>
    </div>
  );
};

export default MyPage;